{% extends 'main/layout.html' %}
{% block title%}Работа с базой данных{% endblock %}
{% block content%}
{% load util %}
    <div class="features">
        <div class="top-befor-header">
            <h1>Таблица соответствия группе</h1>
            {% if request.user.is_staff %}
            <div class="add-data">
                <div class="inner-form-data-button">
                    <br>
                    <form method="POST" enctype="multipart/form-data" class="big-filter-form" >
                        {% csrf_token %}
                        <div class="two_button_label">
                            <button type="submit" name="export" value="create_file">
                                Экспортировать в Excel
                            </button>
                            <label for="import_data">EXCEL для сопоставления</label>
                            <input type="file" id="import_data" name="import_file" class="input-file">
                            <button type="submit">
                                Загрузить
                            </button> 
                        </div>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
        <div class='filter-data'>
            <form action="" class="small-filter-form" method="POST">
                {% csrf_token %}
                <label for="common_article_id" class="rand">
                    <span>Артикул</span><br>
                    <input type="text" id="common_article_id" name="common_article" class="input-field">
                </label>
                <label for="status" class="rand">
                    <span>Группа</span><br>
                    {{ form.group_name }}
                </label>
                <div class="inner-form-data">
                    <br>
                    <input type="Submit" id="filter" name="filter" value="Фильтровать" />
                </div>
            </form>
        </div>
            <table style="overflow-x: scroll; display: block; width: 100%;">
                <tr>
                    <th rowspan="2">Артикул</th>
                    {% for date in date_list %}
                        <th colspan="3">{{ date }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    {% for date in date_list %}
                        <th>WB</th>
                        <th>OZON</th>
                        <th>YANDEX</th>
                    {% endfor %}
                </tr>
                {% for el in article_list %}
                    <tr>
                        <td>{{ el.common_article }}</td>
                        {% for date in date_list %}
                            {% with my_var=date|stringformat:"s" %}
                                <td>{{ data_for_user|get_item:el.common_article|get_item:my_var|get_item:"wb_price" }} </td>
                                <td>{{ data_for_user|get_item:el.common_article|get_item:my_var|get_item:"ozon_price" }} </td>
                                <td>{{ data_for_user|get_item:el.common_article|get_item:my_var|get_item:"yandex_price" }} </td>
                            {% endwith %}
                        {% endfor %} 
                    </tr>
                {% endfor %}
            </table>
    </div>    
        
{% endblock %}
